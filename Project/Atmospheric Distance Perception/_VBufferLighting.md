| 目的                                                                                                                                                                                                             | 檔案                                                                                                     | **說明**                                                                                                                             |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------- |
| 是否啟用體積霧 (Volumetric Fog) 的布林與品質來源                                                                                                                                                                              | Runtime/Lighting/AtmosphericScattering/Fog.cs                                                          | 讀取 Fog Volume 參數（如 enableVolumetricFog, screenResolutionPercentage, volumeSliceCount, sliceDistributionUniformity, depthExtent 等）。 |
| 計算 / 填入全域常數緩衝（含 _VBufferViewportSize, _VBufferLightingViewportScale, _VBufferLightingViewportLimit, _VBufferDistanceEncodingParams, _VBufferDistanceDecodingParams, _VBufferSliceCount, _VBufferLastSliceDist） | Runtime/Lighting/VolumetricLighting/HDRenderPipeline.VolumetricLighting.cs                             | 關鍵：建立並更新 V-Buffer 幾何與距離編碼參數，分配/重建 3D 霧體光照與密度貼圖。                                                                                    |
| V-Buffer 索引 / 深度編碼/解碼與取樣公式                                                                                                                                                                                     | Runtime/Lighting/VolumetricLighting/VBuffer.hlsl                                                       | 定義將螢幕座標 + 深度 → 3D 體積座標 (uvz) 的函式；使用 _VBufferDistanceEncodingParams / _VBufferDistanceDecodingParams。                               |
| 體積密度（局部霧、體積雲之外的一般體積介質）體素化                                                                                                                                                                                      | Runtime/Lighting/VolumetricLighting/VolumeVoxelization.compute                                         | 將場景中 Local Volumetric Fog、Fog Base Extinction/Scattering 體積化到密度/相函數暫存 3D 紋理。                                                       |
| 體積光輸出（寫入 _VBufferLighting 3D 紋理）                                                                                                                                                                               | Runtime/Lighting/VolumetricLighting/VolumetricLighting.compute                                         | Ray marching / 跨 slice 積分：單次散射、多次近似、光影遮罩、體積光結果存入 _VBufferLighting。                                                                 |
| 雲與體積光共用（雲層混合時讀 _VBufferLighting）                                                                                                                                                                               | Runtime/Lighting/VolumetricLighting/HDRenderPipeline.VolumetricClouds*.cs                              | 在雲 Upscale / Combine Pass 取樣 _VBufferLighting 做能量疊加。                                                                               |
| 全域常數緩衝結構定義（C# <-> HLSL 對齊）                                                                                                                                                                                     | Runtime/ShaderLibrary/ShaderVariablesGlobal.cs 與產生的 ShaderVariablesGlobal（對應 HLSL）                     | 含 _VBuffer* 欄位。                                                                                                                    |
| 最後將體積結果套用到不透明/天空                                                                                                                                                                                               | Runtime/Lighting/AtmosphericScattering/AtmosphericScattering.hlsl / OpaqueAtmosphericScattering.shader | 表面著色時取樣 _VBufferLighting 補上體積散射。                                                                                                   |
| Render Graph 排程與調用順序                                                                                                                                                                                           | Runtime/RenderPipeline/HDRenderPipeline.cs / HDRenderPipeline.RenderGraph.cs                           | 控制呼叫「體積體素化 → 體積光積分 → 雲 → 後續合成」。                                                                                                    |
| 公用 RTHandle 尺寸/子配置資訊（供 viewport scale / limit 計算）                                                                                                                                                              | Runtime/RenderPipeline/Utility/HDUtils.cs                                                              | 取得實際 RTHandle 物理尺寸與 viewport。                                                                                                      |